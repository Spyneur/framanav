<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="robots" content="noindex, nofollow" />
  <title>Cortex</title>
  <script>
    cortex = (action, msg) => {
      const m = msg;
      switch (action) {
        case 'o': // output to Minus
          try {
            window.parent.postMessage(localStorage.framanav, '*');
          } catch (e) {
            window.parent.postMessage(JSON.stringify(this.init), '*');
          }
          break;
        case 'i': // input in localStorage
          try {
            localStorage.setItem(key, JSON.stringify(m));
          } catch (e) {
            // Pas accès au localStorage
          }
          break;
        default: // init
          try {
            if (localStorage[key] === undefined) {
              this.cortex('i', this.init);
            }
          } catch (e) {
            // Pas accès au localStorage
          }
          this.cortex('o');
          window.onmessage = function listenMinus(event) {
            /* if(event.origin !== 'frama.web') {
              return;
            } */
            try {
              const payload = JSON.parse(event.data);
              if (payload.framanav !== this.init
                && Object.keys(payload[key]).length) {
                mergeObj(this.storage, payload[key]);
                this.cortex('i', this.storage);
              }
              this.cortex('o');
            } catch (e) {
              // Pas du JSON ?
            }
          };
          break;
        }
      }
    </script>
</head>
<body></body>
</html>